<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω T·∫≠p Trung v2.0 - THCS B√¨nh Th·∫°nh</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --navy: #0c2461; --blue: #1e90ff; --green: #28a745; --red: #ff3b30; --light: #f4f7f6; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--light); margin: 0; padding: 20px; }
        
        .admin-container { max-width: 1100px; margin: 0 auto; }
        header { background: white; padding: 15px 25px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; border-left: 6px solid var(--navy); }
        h1 { color: var(--navy); margin: 0; font-size: 1.4rem; }

        .grid-layout { display: grid; grid-template-columns: 1.5fr 0.5fr; gap: 20px; }
        @media (max-width: 768px) { .grid-layout { grid-template-columns: 1fr; } }

        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .card-title { font-weight: 800; color: var(--navy); border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }

        /* Style cho danh m·ª•c m√°y qu√©t */
        .device-item { 
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr 1fr;
            align-items: center; 
            padding: 15px; 
            background: #fff; 
            border-radius: 10px; 
            margin-bottom: 10px; 
            border: 1px solid #e1e8f0;
            transition: 0.3s;
        }
        .device-item:hover { transform: scale(1.01); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .class-info .name { font-weight: bold; color: var(--navy); font-size: 1.1rem; }
        .class-info .time { font-size: 0.7rem; color: #888; }
        
        .stat-num { text-align: center; }
        .stat-label { font-size: 0.65rem; color: #666; display: block; text-transform: uppercase; }
        .stat-value { font-size: 1.2rem; font-weight: 800; }

        .val-present { color: var(--green); }
        .val-absent { color: var(--red); }
        .val-total { color: var(--navy); }

        .status-online { display: inline-block; width: 10px; height: 10px; background: var(--green); border-radius: 50%; margin-right: 8px; animation: blink 1.5s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .btn-refresh { width: 100%; padding: 12px; border: none; background: var(--navy); color: white; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="admin-container">
    <header>
        <div>
            <h1>H·ªÜ TH·ªêNG QU·∫¢N L√ù T·∫¨P TRUNG v2.0</h1>
            <small>THCS B√¨nh Th·∫°nh - Huy Admin</small>
        </div>
        <div id="live-clock" style="font-weight: bold; color: var(--blue);">00:00:00</div>
    </header>

    <div class="grid-layout">
        <div class="card">
            <div class="card-title">
                <span>üì∫ TR·∫†NG TH√ÅI C√ÅC L·ªöP</span>
                <span id="device-count" style="font-size: 0.8rem; background: var(--navy); color: white; padding: 2px 8px; border-radius: 10px;">0 Online</span>
            </div>
            <div id="status-list">
                <p style="text-align:center; color:#999;">ƒêang t√¨m thi·∫øt b·ªã...</p>
            </div>
        </div>

        <div class="card">
            <div class="card-title">üöÄ ƒêI·ªÄU KHI·ªÇN</div>
            <p style="font-size: 0.8rem; color: #666;">D·ªØ li·ªáu t·ª± ƒë·ªông c·∫≠p nh·∫≠t m·ªói khi c√≥ h·ªçc sinh qu√©t m·∫∑t.</p>
            <button class="btn-refresh" onclick="location.reload()">L√ÄM M·ªöI TRANG</button>
            <div id="recent-logs" style="margin-top:20px; font-size: 0.8rem;">
                </div>
        </div>
    </div>
</div>

<script>
    // C·∫§U H√åNH FIREBASE - B·∫°n ∆°i, nh·ªõ gi·ªØ nguy√™n apiKey c·ªßa Huy nh√©
    const firebaseConfig = {
        apiKey: "AIzaSyCRlm5nRrp3DTXV-XJITup3xEHAc5re7oU",
        databaseURL: "https://diemdanhthcsbt-default-rtdb.asia-southeast1.firebasedatabase.app/",
        projectId: "diemdanhthcsbt",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // L·∫ÆNG NGHE D·ªÆ LI·ªÜU T·ª™ "DiemDanh_Status"
    db.ref('DiemDanh_Status').on('value', snapshot => {
        const statusList = document.getElementById('status-list');
        const deviceCount = document.getElementById('device-count');
        statusList.innerHTML = '';
        const data = snapshot.val();
        
        if (data) {
            const devices = Object.values(data);
            deviceCount.innerText = devices.length + " L·ªõp Online";
            
            devices.forEach(device => {
                const item = document.createElement('div');
                item.className = 'device-item';
                
                item.innerHTML = `
                    <div class="class-info">
                        <div class="name"><span class="status-online"></span>${device.name}</div>
                        <div class="time">C·∫≠p nh·∫≠t: ${device.lastSeen || '--:--'}</div>
                    </div>
                    <div class="stat-num">
                        <span class="stat-label">Sƒ© S·ªë</span>
                        <span class="stat-value val-total">${device.totalStudents || 0}</span>
                    </div>
                    <div class="stat-num">
                        <span class="stat-label">Hi·ªán Di·ªán</span>
                        <span class="stat-value val-present">${device.presentStudents || 0}</span>
                    </div>
                    <div class="stat-num">
                        <span class="stat-label">V·∫Øng</span>
                        <span class="stat-value val-absent">${device.absentStudents || 0}</span>
                    </div>
                `;
                statusList.appendChild(item);
            });
        } else {
            deviceCount.innerText = "0 Online";
            statusList.innerHTML = '<p style="text-align:center; color:#999; padding: 20px;">Kh√¥ng c√≥ l·ªõp n√†o ƒëang ho·∫°t ƒë·ªông.</p>';
        }
    });

    // ƒê·ªíNG H·ªí
    setInterval(() => {
        document.getElementById('live-clock').innerText = new Date().toLocaleTimeString('vi-VN');
    }, 1000);
</script>
</body>
</html>
